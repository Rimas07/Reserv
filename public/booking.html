<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Urologicka klinika ‚Äì Online rezervace</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f0f2f5;color:#111827;line-height:1.5;min-height:100vh}
.container{max-width:480px;margin:0 auto;min-height:100vh;background:#fff;box-shadow:0 0 40px rgba(0,0,0,.08)}
.screen{display:none}
.screen.active{display:block}

/* Language bar */
.lang-bar{display:flex;justify-content:flex-end;gap:4px;padding:8px 16px;background:#fff}
.lang-btn{background:#fff;border:2px solid #e5e7eb;border-radius:8px;padding:5px 12px;cursor:pointer;font-size:12px;font-weight:700;color:#6b7280;transition:all .2s}
.lang-btn:hover{border-color:#14b8a6;color:#14b8a6}
.lang-btn.active{background:#14b8a6;color:#fff;border-color:#14b8a6}

/* Header gradient */
.hero{background:linear-gradient(135deg,#0d9488,#14b8a6,#2dd4bf);padding:32px 24px;color:#fff;text-align:center}
.hero-icon{font-size:36px;margin-bottom:8px}
.hero h1{font-size:22px;font-weight:800;margin-bottom:6px}
.hero-sub{font-size:13px;opacity:.85}

/* Alert banner */
.alert-banner{margin:16px;padding:14px 16px;background:#f0fdfa;border:2px solid #99f6e4;border-radius:12px;display:flex;align-items:center;gap:10px}
.alert-banner .icon{font-size:20px;flex-shrink:0}
.alert-banner .title{font-size:13px;font-weight:700;color:#0d9488}
.alert-banner .sub{font-size:12px;color:#6b7280}

/* Cards */
.card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,.08);margin:0 16px 16px;padding:20px}
.card h2{font-size:14px;font-weight:700;margin-bottom:12px}

/* Service cards */
.service-item{background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:14px;display:flex;gap:12px;align-items:flex-start;margin-bottom:8px}
.service-item:last-child{margin-bottom:0}
.service-item .svc-icon{font-size:24px;flex-shrink:0}
.service-item .svc-name{font-size:14px;font-weight:600}
.service-item .svc-desc{font-size:12px;color:#6b7280;margin-top:2px}
.service-item .svc-dur{font-size:11px;color:#14b8a6;font-weight:600;flex-shrink:0}

/* Info chips */
.info-chips{display:flex;gap:8px;margin:0 16px 20px}
.info-chip{flex:1;background:#f8fafc;border-radius:8px;padding:10px;text-align:center}
.info-chip .chip-icon{font-size:18px;margin-bottom:4px}
.info-chip .chip-text{font-size:10px;color:#6b7280;font-weight:600}

/* Buttons */
.btn{display:block;background:#14b8a6;color:#fff;border:none;padding:14px 24px;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer;width:calc(100% - 32px);margin:0 16px 24px;text-align:center;transition:background .2s}
.btn:hover{background:#0d9488}
.btn:disabled{background:#94a3b8;cursor:not-allowed}
.btn-outline{background:transparent;color:#14b8a6;border:2px solid #14b8a6}
.btn-outline:hover{background:#f0fdfa}
.btn-sm{padding:10px 16px;font-size:14px;width:auto;margin:0;display:inline-block}
.btn-back{background:none;border:none;padding:0;cursor:pointer;font-size:18px;color:#6b7280}

/* Top bar with back + title */
.screen-header{padding:16px;border-bottom:1px solid #e5e7eb;display:flex;align-items:center;gap:10px}
.screen-header h2{font-size:16px;font-weight:700;margin:0}

/* Step indicator */
.steps{display:flex;justify-content:center;gap:4px;padding:16px}
.step{display:flex;align-items:center;gap:4px}
.step-circle{width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700}
.step-circle.done{background:#14b8a6;color:#fff}
.step-circle.active{background:#14b8a6;color:#fff}
.step-circle.pending{background:#e5e7eb;color:#9ca3af}
.step-label{font-size:11px;font-weight:600}
.step-label.active-label{color:#111827}
.step-label.pending-label{color:#9ca3af}
.step-sep{color:#e5e7eb;margin:0 2px}

/* Service type pills */
.svc-pills{padding:0 16px 12px}
.svc-pills-label{font-size:12px;font-weight:600;color:#6b7280;margin-bottom:6px}
.svc-pills-wrap{display:flex;gap:6px;flex-wrap:wrap}
.svc-pill{padding:8px 14px;border-radius:8px;font-size:12px;font-weight:600;background:#f0f2f5;color:#6b7280;cursor:pointer;border:none;transition:all .2s}
.svc-pill.active{background:#14b8a6;color:#fff}
.svc-pill:hover:not(.active){background:#e5e7eb}

/* Doctor cards */
.doctor-list{padding:0 16px 24px;display:flex;flex-direction:column;gap:12px}
.doctor-card{background:#fff;border:2px solid #e5e7eb;border-radius:14px;padding:16px;cursor:pointer;transition:border-color .2s}
.doctor-card:hover{border-color:#14b8a6}
.doctor-inner{display:flex;gap:14px;align-items:center}
.doc-avatar{width:60px;height:60px;border-radius:50%;background:#f0fdfa;display:flex;align-items:center;justify-content:center;font-size:30px;flex-shrink:0;border:2px solid #99f6e4}
.doc-info{flex:1}
.doc-name{font-size:15px;font-weight:700}
.doc-spec{font-size:12px;color:#14b8a6;font-weight:600}
.doc-langs{display:flex;gap:4px;margin-top:6px}
.doc-lang-tag{padding:2px 8px;border-radius:12px;font-size:10px;font-weight:600;background:#cffafe;color:#0891b2}
.doc-slots{text-align:right;flex-shrink:0}
.doc-slots-num{font-size:14px;font-weight:800;color:#14b8a6}
.doc-slots-label{font-size:10px;color:#9ca3af}
.doc-arrow{font-size:16px;margin-top:4px;color:#9ca3af}
.doc-hint{background:#fffbeb;border:1px solid #fde68a;border-radius:10px;padding:12px;font-size:12px;color:#92400e;display:flex;gap:8px;align-items:center}

/* Selected doctor info */
.selected-doc-info{margin:0 16px 12px;padding:10px 14px;background:#f0fdfa;border:1px solid #99f6e4;border-radius:10px;display:flex;align-items:center;gap:10px;font-size:13px}

/* Month nav */
.month-nav{display:flex;align-items:center;justify-content:center;gap:16px;padding:8px 16px;margin-bottom:8px}
.month-nav button{background:none;border:none;font-size:16px;color:#9ca3af;cursor:pointer;padding:4px 8px}
.month-nav button:hover{color:#14b8a6}
.month-name{font-size:15px;font-weight:700}

/* Day picker (horizontal) */
.day-picker{display:flex;gap:6px;padding:0 16px;margin-bottom:16px;overflow-x:auto;-webkit-overflow-scrolling:touch}
.day-picker::-webkit-scrollbar{display:none}
.day-chip{min-width:56px;padding:10px 8px;border-radius:12px;text-align:center;cursor:pointer;border:1px solid #e5e7eb;background:#fff;transition:all .2s;flex-shrink:0}
.day-chip:hover:not(.selected):not(.disabled){border-color:#14b8a6}
.day-chip.selected{background:#14b8a6;color:#fff;border-color:#14b8a6}
.day-chip.disabled{opacity:.4;cursor:default}
.day-chip .dw{font-size:11px;font-weight:600}
.day-chip .dn{font-size:20px;font-weight:800}
.day-chip .dm{font-size:10px}
.day-chip .ds{font-size:9px;margin-top:4px;font-weight:600;color:#14b8a6}
.day-chip.selected .dw,.day-chip.selected .dm{opacity:.8}
.day-chip.selected .ds{color:#fff}

/* Time slots */
.slots-section{padding:0 16px 24px}
.slots-period-label{font-size:11px;font-weight:600;color:#9ca3af;margin-bottom:6px}
.slots-grid{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px}
.time-slot{padding:10px 16px;border-radius:10px;font-size:14px;font-weight:600;background:#f0fdfa;color:#0d9488;cursor:pointer;border:1px solid #99f6e4;min-width:64px;text-align:center;transition:all .2s}
.time-slot:hover:not(.selected){background:#ccfbf1}
.time-slot.selected{background:#14b8a6;color:#fff;border-color:#14b8a6}

/* Booking summary */
.booking-summary{margin:0 16px 16px;padding:14px;background:#f0fdfa;border:1px solid #99f6e4;border-radius:12px}
.booking-summary .bs-title{font-size:12px;font-weight:700;color:#0d9488;margin-bottom:6px}
.booking-summary .bs-line{font-size:13px;color:#6b7280;margin-top:2px}
.booking-summary .bs-doctor{font-size:14px;font-weight:700}

/* Form */
.form-area{padding:0 16px 24px}
.form-group{margin-bottom:14px}
.form-group label{display:block;font-size:12px;font-weight:600;color:#6b7280;margin-bottom:4px}
.form-group input,.form-group select,.form-group textarea{width:100%;padding:11px 14px;border:1px solid #e5e7eb;border-radius:10px;font-size:14px;background:#fff;transition:border-color .2s;font-family:inherit}
.form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:#14b8a6}
.form-group textarea{height:80px;resize:vertical}
.checkbox-group{display:flex;align-items:flex-start;gap:8px;padding:8px 0;margin-bottom:14px}
.checkbox-group input[type=checkbox]{margin-top:3px;width:18px;height:18px;accent-color:#14b8a6}
.checkbox-group label{font-size:12px;color:#6b7280;line-height:1.4}

/* Confirmation */
.confirm-wrap{padding:60px 24px;text-align:center}
.confirm-icon{width:80px;height:80px;border-radius:50%;background:#d1fae5;margin:0 auto 20px;display:flex;align-items:center;justify-content:center;font-size:40px}
.confirm-wrap h2{font-size:22px;font-weight:800;margin-bottom:6px}
.confirm-sub{font-size:13px;color:#6b7280;margin-bottom:24px}
.confirm-details{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:20px;text-align:left;margin-bottom:20px}
.confirm-row{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #f0f2f5}
.confirm-row:last-child{border:none}
.confirm-row .cl{font-size:13px;color:#9ca3af}
.confirm-row .cv{font-size:13px;font-weight:600}
.confirm-reminder{padding:14px;background:#fffbeb;border:1px solid #fde68a;border-radius:10px;font-size:12px;color:#92400e;text-align:left;margin-bottom:20px}

/* Loading / errors */
.loading{text-align:center;padding:20px;color:#6b7280}
.error-msg{background:#fef2f2;color:#991b1b;border-radius:8px;padding:12px;margin:12px 0;font-size:13px}
.no-slots-msg{color:#9ca3af;font-size:13px}
</style>
</head>
<body>
<div class="container">

<!-- Language selector -->
<div class="lang-bar">
  <button class="lang-btn" data-lang="cs" onclick="setLang('cs')">CZ</button>
  <button class="lang-btn" data-lang="en" onclick="setLang('en')">EN</button>
  <button class="lang-btn" data-lang="ru" onclick="setLang('ru')">RU</button>
  <button class="lang-btn" data-lang="uk" onclick="setLang('uk')">UA</button>
</div>

<!-- SCREEN 1: Home -->
<div id="screen1" class="screen active">
  <div class="hero">
    <div class="hero-icon">ü©∫</div>
    <h1 data-t="clinicName"></h1>
    <p class="hero-sub">üìç U Vleƒçky 3086/6, √öst√≠ nad Labem &middot; ‚òé +420 222 333 444</p>
  </div>

  <div class="alert-banner">
    <span class="icon">üì¢</span>
    <div>
      <div class="title" data-t="bannerOpen"></div>
      <div class="sub" data-t="bannerSub"></div>
    </div>
  </div>

  <div class="card">
    <h2 data-t="ourServices"></h2>
    <div id="serviceCards"></div>
  </div>

  <div class="info-chips">
    <div class="info-chip"><div class="chip-icon">üõ°</div><div class="chip-text">VZP, ƒåPZP, OZP</div></div>
    <div class="info-chip"><div class="chip-icon">üïê</div><div class="chip-text" data-t="hoursValue"></div></div>
    <div class="info-chip"><div class="chip-icon">üÖøÔ∏è</div><div class="chip-text" data-t="parking"></div></div>
  </div>

  <button class="btn" onclick="goTo(2)" data-t="bookBtn"></button>
</div>

<!-- SCREEN 2: Doctor selection -->
<div id="screen2" class="screen">
  <div class="screen-header">
    <button class="btn-back" onclick="goTo(1)">‚Üê</button>
    <h2 data-t="selectDoctor"></h2>
  </div>

  <div id="stepsBar2"></div>

  <div class="svc-pills">
    <div class="svc-pills-label" data-t="serviceType"></div>
    <div class="svc-pills-wrap" id="servicePills"></div>
  </div>

  <div class="doctor-list" id="doctorsList">
    <div class="loading" data-t="loadingDoctors"></div>
  </div>
</div>

<!-- SCREEN 3: Date & time -->
<div id="screen3" class="screen">
  <div class="screen-header">
    <button class="btn-back" onclick="goTo(2)">‚Üê</button>
    <h2 data-t="selectDateTime"></h2>
  </div>

  <div id="stepsBar3"></div>

  <div id="selectedDoctorInfo" class="selected-doc-info"></div>

  <div class="month-nav">
    <button onclick="changeMonth(-1)">‚Äπ</button>
    <span class="month-name" id="calMonthName"></span>
    <button onclick="changeMonth(1)">‚Ä∫</button>
  </div>

  <div class="day-picker" id="dayPicker"></div>

  <div id="slotsContainer" class="slots-section" style="display:none">
    <div id="slotsDateLabel" style="font-size:13px;font-weight:700;margin-bottom:10px;color:#6b7280"></div>
    <div id="morningSlots">
      <div class="slots-period-label">üåÖ <span data-t="morning"></span></div>
      <div class="slots-grid" id="morningGrid"></div>
    </div>
    <div id="afternoonSlots">
      <div class="slots-period-label">üå§ <span data-t="afternoon"></span></div>
      <div class="slots-grid" id="afternoonGrid"></div>
    </div>
    <div id="noSlots" style="display:none;text-align:center;padding:20px;color:#9ca3af" data-t="noSlots"></div>
  </div>

  <div id="slotsLoading" class="loading" style="display:none" data-t="loadingSlots"></div>

  <button id="continueBtn" class="btn" style="display:none" onclick="goToForm()"></button>
</div>

<!-- SCREEN 4: Patient form -->
<div id="screen4" class="screen">
  <div class="screen-header">
    <button class="btn-back" onclick="goTo(3)">‚Üê</button>
    <h2 data-t="yourDetails"></h2>
  </div>

  <div id="stepsBar4"></div>

  <div id="bookingSummary" class="booking-summary"></div>

  <div class="form-area">
    <form id="patientForm" onsubmit="submitBooking(event)">
      <div class="form-group">
        <label data-t="fullName"></label>
        <input type="text" id="pName" required data-t-ph="phName">
      </div>
      <div class="form-group">
        <label data-t="phoneLabel"></label>
        <input type="tel" id="pPhone" required placeholder="+420 777 123 456">
      </div>
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="pEmail" placeholder="jan@example.com">
      </div>
      <div class="form-group">
        <label data-t="birthDate"></label>
        <input type="date" id="pBirth">
      </div>
      <div class="form-group">
        <label data-t="insuranceLabel"></label>
        <select id="pInsurance">
          <option value="" data-t="selectOption"></option>
          <option value="VZP (111)">VZP (111)</option>
          <option value="CPZP (205)">CPZP (205)</option>
          <option value="OZP (207)">OZP (207)</option>
          <option value="Vojenska (201)">Vojenska (201)</option>
          <option value="Samoplatce" data-t-opt="selfPay"></option>
        </select>
      </div>
      <div class="form-group">
        <label data-t="description"></label>
        <textarea id="pDesc" data-t-ph="phDesc"></textarea>
      </div>
      <div class="checkbox-group">
        <input type="checkbox" id="pGdpr" required>
        <label for="pGdpr" data-t="gdpr"></label>
      </div>
      <div id="bookingError" class="error-msg" style="display:none"></div>
      <button type="submit" class="btn" style="width:100%;margin:0" id="submitBtn" data-t="confirmBooking"></button>
    </form>
  </div>
</div>

<!-- SCREEN 5: Confirmation -->
<div id="screen5" class="screen">
  <div class="confirm-wrap">
    <div class="confirm-icon">‚úÖ</div>
    <h2 data-t="bookingConfirmed"></h2>
    <p class="confirm-sub" data-t="smsSent"></p>
    <div id="confirmDetails" class="confirm-details"></div>
    <div class="confirm-reminder" data-t="reminderText"></div>
    <button class="btn" style="width:100%;margin:0 0 8px 0" onclick="goTo(1);resetForm()" data-t="backHome"></button>
  </div>
</div>

</div>

<script>
const T={
cs:{
  clinicName:'Urologick√° klinika',
  bannerOpen:'Online rezervace je otev≈ôena',bannerSub:'Vyberte si vhodn√Ω term√≠n',
  ourServices:'Slu≈æby',parking:'Parkov√°n√≠',
  hoursValue:'Po-P√° 8:00-17:00',
  svc1:'Prim√°rn√≠ konzultace',svc1d:'Vy≈°et≈ôen√≠, anamn√©za, objedn√°n√≠ vy≈°et≈ôen√≠',svc1dur:'30 min',
  svc2:'Opakovan√° n√°v≈°tƒõva',svc2d:'V√Ωsledky anal√Ωz, √∫prava l√©ƒçby',svc2dur:'20 min',
  svc3:'Ultrazvukov√© vy≈°et≈ôen√≠',svc3d:'UZ ledvin, moƒç. mƒõch√Ω≈ôe, prostaty',svc3dur:'30 min',
  svc4:'Urologick√© procedury',svc4d:'L√©ƒçebn√© procedury dle ordinace l√©ka≈ôe',svc4dur:'15-45 min',
  selfPay:'Samopl√°tce',
  bookBtn:'Objednat se na vy≈°et≈ôen√≠ ‚Üí',
  back:'Zpƒõt',selectDoctor:'Vyberte l√©ka≈ôe',serviceType:'Typ slu≈æby:',
  loadingDoctors:'Naƒç√≠t√°m l√©ka≈ôe...',langLabel:'Jazyky',slotsToday:'voln√Ωch term√≠n≈Ø',
  noDoctors:'≈Ω√°dn√≠ l√©ka≈ôi nejsou k dispozici.',errorDoctors:'Chyba p≈ôi naƒç√≠t√°n√≠ l√©ka≈ô≈Ø.',
  selectDateTime:'Vyberte ƒças',
  months:['Leden','√önor','B≈ôezen','Duben','Kvƒõten','ƒåerven','ƒåervenec','Srpen','Z√°≈ô√≠','≈ò√≠jen','Listopad','Prosinec'],
  daysShort:['Po','√öt','St','ƒåt','P√°','So','Ne'],
  morning:'Dopoledne',afternoon:'Odpoledne',noSlots:'≈Ω√°dn√© voln√© term√≠ny',loadingSlots:'Naƒç√≠t√°m term√≠ny...',
  noSlotsShort:'≈Ω√°dn√© term√≠ny',errorSlots:'Chyba p≈ôi naƒç√≠t√°n√≠ term√≠n≈Ø.',
  continueWith:'Pokraƒçovat ‚Äî',
  yourDetails:'Va≈°e √∫daje',fullName:'Jm√©no a p≈ô√≠jmen√≠ *',phoneLabel:'Telefon *',
  birthDate:'Datum narozen√≠',insuranceLabel:'Poji≈°≈•ovna',selectOption:'-- Vyberte --',
  description:'Popis probl√©mu (nepovinn√©)',phName:'Jan Nov√°k',phDesc:'Struƒçnƒõ popi≈°te va≈°e obt√≠≈æe...',
  gdpr:'Souhlas√≠m se zpracov√°n√≠m osobn√≠ch √∫daj≈Ø v souladu s GDPR pro √∫ƒçely rezervace a poskytov√°n√≠ zdravotn√≠ p√©ƒçe.',
  confirmBooking:'Potvrdit rezervaci ‚úì',sending:'Odes√≠l√°m...',
  errorBooking:'Chyba p≈ôi rezervaci',errorGeneric:'Do≈°lo k chybƒõ. Zkuste to pros√≠m znovu.',
  bookingConfirmed:'Rezervace potvrzena!',smsSent:'SMS potvrzen√≠ bylo odesl√°no na v√°≈° telefon',
  doctor:'L√©ka≈ô',service:'Slu≈æba',date:'Datum',time:'ƒåas',patient:'Pacient',
  reminderText:'üìç Nezapome≈àte: Vezmƒõte s sebou kartiƒçku poji≈°tƒõnce a obƒçansk√Ω pr≈Økaz. P≈ôijƒète 10 minut p≈ôed vy≈°et≈ôen√≠m.',
  backHome:'Zpƒõt na hlavn√≠ str√°nku',
  stepDoctor:'L√©ka≈ô',stepTime:'ƒåas',stepData:'√ödaje',stepDone:'Hotovo',
  yourBooking:'Va≈°e rezervace:',hintMultilang:''
},
en:{
  clinicName:'Urology Clinic',
  bannerOpen:'Online booking is open',bannerSub:'Choose your preferred time slot',
  ourServices:'Services',parking:'Parking',
  hoursValue:'Mon-Fri 8:00-17:00',
  svc1:'Initial consultation',svc1d:'Examination, medical history, ordering tests',svc1dur:'30 min',
  svc2:'Follow-up visit',svc2d:'Test results, treatment adjustment',svc2dur:'20 min',
  svc3:'Ultrasound examination',svc3d:'Kidney, bladder, prostate ultrasound',svc3dur:'30 min',
  svc4:'Urological procedures',svc4d:'Treatment procedures as prescribed',svc4dur:'15-45 min',
  selfPay:'Self-pay',
  bookBtn:'Book an appointment ‚Üí',
  back:'Back',selectDoctor:'Choose a doctor',serviceType:'Service type:',
  loadingDoctors:'Loading doctors...',langLabel:'Languages',slotsToday:'available slots',
  noDoctors:'No doctors available.',errorDoctors:'Error loading doctors.',
  selectDateTime:'Choose date & time',
  months:['January','February','March','April','May','June','July','August','September','October','November','December'],
  daysShort:['Mo','Tu','We','Th','Fr','Sa','Su'],
  morning:'Morning',afternoon:'Afternoon',noSlots:'No available slots',loadingSlots:'Loading slots...',
  noSlotsShort:'No slots',errorSlots:'Error loading slots.',
  continueWith:'Continue ‚Äî',
  yourDetails:'Your details',fullName:'Full name *',phoneLabel:'Phone *',
  birthDate:'Date of birth',insuranceLabel:'Insurance',selectOption:'-- Select --',
  description:'Problem description (optional)',phName:'John Smith',phDesc:'Briefly describe your symptoms...',
  gdpr:'I agree to the processing of personal data in accordance with GDPR for booking and healthcare purposes.',
  confirmBooking:'Confirm booking ‚úì',sending:'Sending...',
  errorBooking:'Booking error',errorGeneric:'An error occurred. Please try again.',
  bookingConfirmed:'Booking confirmed!',smsSent:'SMS confirmation has been sent to your phone',
  doctor:'Doctor',service:'Service',date:'Date',time:'Time',patient:'Patient',
  reminderText:'üìç Don\'t forget: Bring your insurance card and ID. Arrive 10 minutes before your appointment.',
  backHome:'Back to main page',
  stepDoctor:'Doctor',stepTime:'Time',stepData:'Details',stepDone:'Done',
  yourBooking:'Your booking:',hintMultilang:''
},
ru:{
  clinicName:'–£—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∫–ª–∏–Ω–∏–∫–∞',
  bannerOpen:'–û–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å—å –æ—Ç–∫—Ä—ã—Ç–∞',bannerSub:'–í—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å',
  ourServices:'–£—Å–ª—É–≥–∏',parking:'–ü–∞—Ä–∫–æ–≤–∫–∞',
  hoursValue:'–ü–Ω-–ü—Ç 8:00-17:00',
  svc1:'–ü–µ—Ä–≤–∏—á–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è',svc1d:'–û—Å–º–æ—Ç—Ä, —Å–±–æ—Ä –∞–Ω–∞–º–Ω–µ–∑–∞, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π',svc1dur:'30 –º–∏–Ω',
  svc2:'–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ø—Ä–∏—ë–º',svc2d:'–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–æ–≤, –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –ª–µ—á–µ–Ω–∏—è',svc2dur:'20 –º–∏–Ω',
  svc3:'–£–ó–ò –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ',svc3d:'–£–ó–ò –ø–æ—á–µ–∫, –º–æ—á–µ–≤–æ–≥–æ –ø—É–∑—ã—Ä—è, –ø—Ä–æ—Å—Ç–∞—Ç—ã',svc3dur:'30 –º–∏–Ω',
  svc4:'–£—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã',svc4d:'–õ–µ—á–µ–±–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é –≤—Ä–∞—á–∞',svc4dur:'15-45 –º–∏–Ω',
  selfPay:'–°–∞–º–æ–ø–ª–∞—Ç–µ–ª—å—â–∏–∫',
  bookBtn:'–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∏—ë–º ‚Üí',
  back:'–ù–∞–∑–∞–¥',selectDoctor:'–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–∞—á–∞',serviceType:'–¢–∏–ø –ø—Ä–∏—ë–º–∞:',
  loadingDoctors:'–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Ä–∞—á–µ–π...',langLabel:'–Ø–∑—ã–∫–∏',slotsToday:'—Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤',
  noDoctors:'–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤—Ä–∞—á–µ–π.',errorDoctors:'–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Ä–∞—á–µ–π.',
  selectDateTime:'–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è',
  months:['–Ø–Ω–≤–∞—Ä—å','–§–µ–≤—Ä–∞–ª—å','–ú–∞—Ä—Ç','–ê–ø—Ä–µ–ª—å','–ú–∞–π','–ò—é–Ω—å','–ò—é–ª—å','–ê–≤–≥—É—Å—Ç','–°–µ–Ω—Ç—è–±—Ä—å','–û–∫—Ç—è–±—Ä—å','–ù–æ—è–±—Ä—å','–î–µ–∫–∞–±—Ä—å'],
  daysShort:['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'],
  morning:'–£—Ç—Ä–æ',afternoon:'–î–µ–Ω—å',noSlots:'–ù–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤',loadingSlots:'–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ—Ç–æ–≤...',
  noSlotsShort:'–ù–µ—Ç —Å–ª–æ—Ç–æ–≤',errorSlots:'–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–æ—Ç–æ–≤.',
  continueWith:'–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚Äî',
  yourDetails:'–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ',fullName:'–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è *',phoneLabel:'–¢–µ–ª–µ—Ñ–æ–Ω *',
  birthDate:'–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è',insuranceLabel:'–°—Ç—Ä–∞—Ö–æ–≤–∫–∞',selectOption:'-- –í—ã–±–µ—Ä–∏—Ç–µ --',
  description:'–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)',phName:'–ò–≤–∞–Ω –ù–æ–≤–∞–∫',phDesc:'–ö—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ –∂–∞–ª–æ–±—ã...',
  gdpr:'–Ø —Å–æ–≥–ª–∞—Å–µ–Ω(–∞) –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å GDPR –¥–ª—è —Ü–µ–ª–µ–π –∑–∞–ø–∏—Å–∏ –∏ –æ–∫–∞–∑–∞–Ω–∏—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –ø–æ–º–æ—â–∏.',
  confirmBooking:'–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–ø–∏—Å—å ‚úì',sending:'–û—Ç–ø—Ä–∞–≤–∫–∞...',
  errorBooking:'–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏',errorGeneric:'–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.',
  bookingConfirmed:'–ó–∞–ø–∏—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!',smsSent:'SMS-–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –≤–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω',
  doctor:'–í—Ä–∞—á',service:'–£—Å–ª—É–≥–∞',date:'–î–∞—Ç–∞',time:'–í—Ä–µ–º—è',patient:'–ü–∞—Ü–∏–µ–Ω—Ç',
  reminderText:'üìç –ù–µ –∑–∞–±—É–¥—å—Ç–µ: –ü—Ä–∏–Ω–µ—Å–∏—Ç–µ –∫–∞—Ä—Ç—É —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏ –∏ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ –ª–∏—á–Ω–æ—Å—Ç–∏. –ü—Ä–∏—Ö–æ–¥–∏—Ç–µ –∑–∞ 10 –º–∏–Ω—É—Ç –¥–æ –ø—Ä–∏—ë–º–∞.',
  backHome:'–ù–∞ –≥–ª–∞–≤–Ω—É—é',
  stepDoctor:'–í—Ä–∞—á',stepTime:'–í—Ä–µ–º—è',stepData:'–î–∞–Ω–Ω—ã–µ',stepDone:'–ì–æ—Ç–æ–≤–æ',
  yourBooking:'–í–∞—à–∞ –∑–∞–ø–∏—Å—å:',hintMultilang:'MUDr. Petrova –≥–æ–≤–æ—Ä–∏—Ç –ø–æ-—Ä—É—Å—Å–∫–∏ –∏ –ø–æ-—É–∫—Ä–∞–∏–Ω—Å–∫–∏'
},
uk:{
  clinicName:'–£—Ä–æ–ª–æ–≥—ñ—á–Ω–∞ –∫–ª—ñ–Ω—ñ–∫–∞',
  bannerOpen:'–û–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å –≤—ñ–¥–∫—Ä–∏—Ç–∏–π',bannerSub:'–û–±–µ—Ä—ñ—Ç—å –∑—Ä—É—á–Ω–∏–π —á–∞—Å –ø—Ä—è–º–æ –∑–∞—Ä–∞–∑',
  ourServices:'–ü–æ—Å–ª—É–≥–∏',parking:'–ü–∞—Ä–∫–æ–≤–∫–∞',
  hoursValue:'–ü–Ω-–ü—Ç 8:00-17:00',
  svc1:'–ü–µ—Ä–≤–∏–Ω–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è',svc1d:'–û–≥–ª—è–¥, –∑–±—ñ—Ä –∞–Ω–∞–º–Ω–µ–∑—É, –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –æ–±—Å—Ç–µ–∂–µ–Ω—å',svc1dur:'30 —Ö–≤',
  svc2:'–ü–æ–≤—Ç–æ—Ä–Ω–∏–π –≤—ñ–∑–∏—Ç',svc2d:'–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∞–Ω–∞–ª—ñ–∑—ñ–≤, –∫–æ—Ä–µ–∫—Ü—ñ—è –ª—ñ–∫—É–≤–∞–Ω–Ω—è',svc2dur:'20 —Ö–≤',
  svc3:'–£–ó–î –æ–±—Å—Ç–µ–∂–µ–Ω–Ω—è',svc3d:'–£–ó–î –Ω–∏—Ä–æ–∫, —Å–µ—á–æ–≤–æ–≥–æ –º—ñ—Ö—É—Ä–∞, –ø—Ä–æ—Å—Ç–∞—Ç–∏',svc3dur:'30 —Ö–≤',
  svc4:'–£—Ä–æ–ª–æ–≥—ñ—á–Ω—ñ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏',svc4d:'–õ—ñ–∫—É–≤–∞–ª—å–Ω—ñ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏ –∑–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è–º –ª—ñ–∫–∞—Ä—è',svc4dur:'15-45 —Ö–≤',
  selfPay:'–°–∞–º–æ–ø–ª–∞—Ç–Ω–∏–∫',
  bookBtn:'–ó–∞–ø–∏—Å–∞—Ç–∏—Å—è –Ω–∞ –ø—Ä–∏–π–æ–º ‚Üí',
  back:'–ù–∞–∑–∞–¥',selectDoctor:'–û–±–µ—Ä—ñ—Ç—å –ª—ñ–∫–∞—Ä—è',serviceType:'–¢–∏–ø –ø–æ—Å–ª—É–≥–∏:',
  loadingDoctors:'–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ª—ñ–∫–∞—Ä—ñ–≤...',langLabel:'–ú–æ–≤–∏',slotsToday:'–≤—ñ–ª—å–Ω–∏—Ö —Å–ª–æ—Ç—ñ–≤',
  noDoctors:'–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –ª—ñ–∫–∞—Ä—ñ–≤.',errorDoctors:'–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ª—ñ–∫–∞—Ä—ñ–≤.',
  selectDateTime:'–û–±–µ—Ä—ñ—Ç—å —á–∞—Å',
  months:['–°—ñ—á–µ–Ω—å','–õ—é—Ç–∏–π','–ë–µ—Ä–µ–∑–µ–Ω—å','–ö–≤—ñ—Ç–µ–Ω—å','–¢—Ä–∞–≤–µ–Ω—å','–ß–µ—Ä–≤–µ–Ω—å','–õ–∏–ø–µ–Ω—å','–°–µ—Ä–ø–µ–Ω—å','–í–µ—Ä–µ—Å–µ–Ω—å','–ñ–æ–≤—Ç–µ–Ω—å','–õ–∏—Å—Ç–æ–ø–∞–¥','–ì—Ä—É–¥–µ–Ω—å'],
  daysShort:['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–ù–¥'],
  morning:'–†–∞–Ω–æ–∫',afternoon:'–ü—ñ—Å–ª—è –æ–±—ñ–¥—É',noSlots:'–ù–µ–º–∞—î –≤—ñ–ª—å–Ω–∏—Ö —Å–ª–æ—Ç—ñ–≤',loadingSlots:'–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ª–æ—Ç—ñ–≤...',
  noSlotsShort:'–ù–µ–º–∞—î —Å–ª–æ—Ç—ñ–≤',errorSlots:'–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ª–æ—Ç—ñ–≤.',
  continueWith:'–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ ‚Äî',
  yourDetails:'–í–∞—à—ñ –¥–∞–Ω—ñ',fullName:"–Ü–º'—è —Ç–∞ –ø—Ä—ñ–∑–≤–∏—â–µ *",phoneLabel:'–¢–µ–ª–µ—Ñ–æ–Ω *',
  birthDate:'–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è',insuranceLabel:'–°—Ç—Ä–∞—Ö–æ–≤–∫–∞',selectOption:'-- –û–±–µ—Ä—ñ—Ç—å --',
  description:'–û–ø–∏—Å –ø—Ä–æ–±–ª–µ–º–∏ (–Ω–µ–æ–±–æ–≤\'—è–∑–∫–æ–≤–æ)',phName:'–Ü–≤–∞–Ω –ù–æ–≤–∞–∫',phDesc:'–ö–æ—Ä–æ—Ç–∫–æ –æ–ø–∏—à—ñ—Ç—å –≤–∞—à—ñ —Å–∫–∞—Ä–≥–∏...',
  gdpr:'–Ø –ø–æ–≥–æ–¥–∂—É—é—Å—å –Ω–∞ –æ–±—Ä–æ–±–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ GDPR –¥–ª—è —Ü—ñ–ª–µ–π –∑–∞–ø–∏—Å—É —Ç–∞ –Ω–∞–¥–∞–Ω–Ω—è –º–µ–¥–∏—á–Ω–æ—ó –¥–æ–ø–æ–º–æ–≥–∏.',
  confirmBooking:'–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∑–∞–ø–∏—Å ‚úì',sending:'–í—ñ–¥–ø—Ä–∞–≤–∫–∞...',
  errorBooking:'–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Å—É',errorGeneric:'–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.',
  bookingConfirmed:'–ó–∞–ø–∏—Å –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ!',smsSent:'SMS-–ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –≤–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω',
  doctor:'–õ—ñ–∫–∞—Ä',service:'–ü–æ—Å–ª—É–≥–∞',date:'–î–∞—Ç–∞',time:'–ß–∞—Å',patient:'–ü–∞—Ü—ñ—î–Ω—Ç',
  reminderText:'üìç –ù–µ –∑–∞–±—É–¥—å—Ç–µ: –í—ñ–∑—å–º—ñ—Ç—å –∑ —Å–æ–±–æ—é –∫–∞—Ä—Ç–∫—É —Å—Ç—Ä–∞—Ö—É–≤–∞–Ω–Ω—è —Ç–∞ –ø–æ—Å–≤—ñ–¥—á–µ–Ω–Ω—è –æ—Å–æ–±–∏. –ü—Ä–∏–π–¥—ñ—Ç—å –∑–∞ 10 —Ö–≤–∏–ª–∏–Ω –¥–æ –ø—Ä–∏–π–æ–º—É.',
  backHome:'–ù–∞ –≥–æ–ª–æ–≤–Ω—É',
  stepDoctor:'–õ—ñ–∫–∞—Ä',stepTime:'–ß–∞—Å',stepData:'–î–∞–Ω—ñ',stepDone:'–ì–æ—Ç–æ–≤–æ',
  yourBooking:'–í–∞—à –∑–∞–ø–∏—Å:',hintMultilang:'MUDr. Petrova —Ä–æ–∑–º–æ–≤–ª—è—î —Ä–æ—Å—ñ–π—Å—å–∫–æ—é —Ç–∞ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é'
}
};

const svcIcons=['üî¨','üìã','üè•','üíâ'];
const svcKeys=['svc1','svc2','svc3','svc4'];

let lang='cs';
function t(key){return T[lang]?.[key]||T['cs']?.[key]||key}

function setLang(l){
  lang=l;localStorage.setItem('rez_lang',l);
  document.querySelectorAll('.lang-btn').forEach(b=>b.classList.toggle('active',b.dataset.lang===l));
  applyTranslations();
  renderServiceCards();
  renderServicePills();
  if(calYear)renderDayPicker();
  updateStepBars();
}

function applyTranslations(){
  document.querySelectorAll('[data-t]').forEach(el=>{
    const key=el.getAttribute('data-t');
    if(T[lang]?.[key])el.textContent=T[lang][key];
  });
  document.querySelectorAll('[data-t-ph]').forEach(el=>{
    const key=el.getAttribute('data-t-ph');
    if(T[lang]?.[key])el.placeholder=T[lang][key];
  });
  document.querySelectorAll('[data-t-opt]').forEach(el=>{
    const key=el.getAttribute('data-t-opt');
    if(T[lang]?.[key])el.textContent=T[lang][key];
  });
  document.title=t('clinicName')+' ‚Äì '+t('bookBtn');
}

function renderServiceCards(){
  const el=document.getElementById('serviceCards');
  el.innerHTML=svcKeys.map((k,i)=>`
    <div class="service-item">
      <span class="svc-icon">${svcIcons[i]}</span>
      <div style="flex:1">
        <div class="svc-name">${t(k)}</div>
        <div class="svc-desc">${t(k+'d')}</div>
      </div>
      <div class="svc-dur">‚è± ${t(k+'dur')}</div>
    </div>
  `).join('');
}

function renderServicePills(){
  const el=document.getElementById('servicePills');
  el.innerHTML=svcKeys.map((k,i)=>`
    <button class="svc-pill${selectedServiceIdx===i?' active':''}" onclick="selectService(${i})">${svcIcons[i]} ${t(k)}</button>
  `).join('');
}

function buildStepBar(activeStep){
  const steps=[t('stepDoctor'),t('stepTime'),t('stepData'),t('stepDone')];
  return '<div class="steps">'+steps.map((s,i)=>{
    const done=i<activeStep;const active=i===activeStep;
    return `<div class="step">
      <div class="step-circle ${done?'done':active?'active':'pending'}">${done?'‚úì':i+1}</div>
      <span class="step-label ${active||done?'active-label':'pending-label'}">${s}</span>
      ${i<3?'<span class="step-sep">‚Äî</span>':''}
    </div>`;
  }).join('')+'</div>';
}

function updateStepBars(){
  const s2=document.getElementById('stepsBar2');if(s2)s2.innerHTML=buildStepBar(0);
  const s3=document.getElementById('stepsBar3');if(s3)s3.innerHTML=buildStepBar(1);
  const s4=document.getElementById('stepsBar4');if(s4)s4.innerHTML=buildStepBar(2);
}

const API='';
let doctors=[];
let selectedDoctor=null;
let selectedServiceIdx=0;
let selectedService='';
let selectedServiceKey='';
let selectedDate='';
let selectedSlot=null;
let calYear,calMonth;

function goTo(n){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById('screen'+n).classList.add('active');
  if(n===2){loadDoctors();updateStepBars()}
  if(n===3){initCalendar();updateStepBars()}
  if(n===4)updateStepBars();
  window.scrollTo(0,0);
}

function selectService(idx){
  selectedServiceIdx=idx;
  selectedServiceKey=svcKeys[idx];
  selectedService=t(selectedServiceKey);
  renderServicePills();
}

async function loadDoctors(){
  const el=document.getElementById('doctorsList');
  el.innerHTML='<div class="loading">'+t('loadingDoctors')+'</div>';
  try{
    const res=await fetch(API+'/doctors');
    doctors=await res.json();
    if(!doctors.length){el.innerHTML='<p style="padding:20px;text-align:center;color:#9ca3af">'+t('noDoctors')+'</p>';return}
    let html='';
    for(const d of doctors){
      let slotCount='';
      try{
        const r=await fetch(API+'/slots?doctorId='+d._id+'&date='+todayStr());
        const s=await r.json();
        slotCount=s.length+' '+t('slotsToday');
      }catch(e){}
      const docIcon=(d.languages||[]).some(l=>['RU','UA'].includes(l.toUpperCase()))?'üë©‚Äç‚öïÔ∏è':'üë®‚Äç‚öïÔ∏è';
      html+=`<div class="doctor-card" onclick="selectDoctor('${d._id}')">
        <div class="doctor-inner">
          <div class="doc-avatar">${docIcon}</div>
          <div class="doc-info">
            <div class="doc-name">${d.name}</div>
            <div class="doc-spec">${d.specialization}</div>
            <div class="doc-langs">${(d.languages||[]).map(l=>'<span class="doc-lang-tag">'+l+'</span>').join('')}</div>
          </div>
          <div class="doc-slots">
            ${slotCount?`<div class="doc-slots-num">${slotCount.split(' ')[0]}</div><div class="doc-slots-label">${t('slotsToday')}</div>`:''}
            <div class="doc-arrow">‚Üí</div>
          </div>
        </div>
      </div>`;
    }
    const hint=t('hintMultilang');
    if(hint)html+=`<div class="doc-hint"><span>üí°</span><span>${hint}</span></div>`;
    el.innerHTML=html;
  }catch(e){el.innerHTML='<div class="error-msg">'+t('errorDoctors')+'</div>'}
}

function selectDoctor(id){
  selectedDoctor=doctors.find(d=>d._id===id);
  if(!selectedService)selectService(selectedServiceIdx);
  goTo(3);
}

function todayStr(){const d=new Date();return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`}

function initCalendar(){
  if(!calYear){const n=new Date();calYear=n.getFullYear();calMonth=n.getMonth()}
  const docIcon=(selectedDoctor.languages||[]).some(l=>['RU','UA'].includes(l.toUpperCase()))?'üë©‚Äç‚öïÔ∏è':'üë®‚Äç‚öïÔ∏è';
  document.getElementById('selectedDoctorInfo').innerHTML=
    `<span style="font-size:20px">${docIcon}</span><div><strong>${selectedDoctor.name}</strong> ¬∑ ${selectedService} (${t(selectedServiceKey+'dur')})</div>`;
  renderDayPicker();
}

function changeMonth(dir){
  calMonth+=dir;
  if(calMonth<0){calMonth=11;calYear--}
  if(calMonth>11){calMonth=0;calYear++}
  selectedDate='';selectedSlot=null;
  document.getElementById('slotsContainer').style.display='none';
  document.getElementById('continueBtn').style.display='none';
  renderDayPicker();
}

function renderDayPicker(){
  const months=T[lang].months;
  document.getElementById('calMonthName').textContent=months[calMonth]+' '+calYear;
  const daysInMonth=new Date(calYear,calMonth+1,0).getDate();
  const today=new Date();today.setHours(0,0,0,0);
  const dayNames=T[lang].daysShort;
  const monthNames=T[lang].months;
  const shortMonth=monthNames[calMonth].substring(0,3).toLowerCase();

  let html='';
  for(let d=1;d<=daysInMonth;d++){
    const dt=new Date(calYear,calMonth,d);
    const dateStr=`${calYear}-${String(calMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const isPast=dt<today;
    const isWeekend=dt.getDay()===0||dt.getDay()===6;
    const dayIdx=(dt.getDay()+6)%7; // Mon=0
    const sel=dateStr===selectedDate;
    const dis=isPast||isWeekend;
    html+=`<div class="day-chip${sel?' selected':''}${dis?' disabled':''}" ${dis?'':`onclick="selectDate('${dateStr}')"`}>
      <div class="dw">${dayNames[dayIdx]}</div>
      <div class="dn">${d}</div>
      <div class="dm">${shortMonth}</div>
    </div>`;
  }
  document.getElementById('dayPicker').innerHTML=html;

  // Scroll to selected or today
  setTimeout(()=>{
    const picker=document.getElementById('dayPicker');
    const selEl=picker.querySelector('.selected')||picker.querySelector('.day-chip:not(.disabled)');
    if(selEl)selEl.scrollIntoView({behavior:'smooth',inline:'center',block:'nearest'});
  },50);
}

async function selectDate(date){
  selectedDate=date;selectedSlot=null;
  document.getElementById('continueBtn').style.display='none';
  renderDayPicker();
  const container=document.getElementById('slotsContainer');
  const loading=document.getElementById('slotsLoading');
  container.style.display='none';loading.style.display='block';
  try{
    const res=await fetch(API+`/slots?doctorId=${selectedDoctor._id}&date=${date}`);
    const slots=await res.json();
    loading.style.display='none';container.style.display='block';
    const parts=date.split('-');
    const dayNames=T[lang].daysShort;
    const dt=new Date(calYear,parseInt(parts[1])-1,parseInt(parts[2]));
    const dayIdx=(dt.getDay()+6)%7;
    document.getElementById('slotsDateLabel').textContent=
      `${dayNames[dayIdx]}, ${parts[2]}.${parts[1]}.${parts[0]} ‚Äî ${slots.length?t('slotsToday'):t('noSlots')}`;

    const morning=slots.filter(s=>s.startTime<'12:00');
    const afternoon=slots.filter(s=>s.startTime>='12:00');

    document.getElementById('morningSlots').style.display=morning.length?'block':'none';
    document.getElementById('morningGrid').innerHTML=morning.length?
      morning.map(s=>`<div class="time-slot" onclick="selectSlot(this,'${s._id}','${s.startTime}','${s.endTime}')">${s.startTime}</div>`).join(''):'';

    document.getElementById('afternoonSlots').style.display=afternoon.length?'block':'none';
    document.getElementById('afternoonGrid').innerHTML=afternoon.length?
      afternoon.map(s=>`<div class="time-slot" onclick="selectSlot(this,'${s._id}','${s.startTime}','${s.endTime}')">${s.startTime}</div>`).join(''):'';

    document.getElementById('noSlots').style.display=slots.length?'none':'block';
  }catch(e){loading.style.display='none';container.innerHTML='<div class="error-msg">'+t('errorSlots')+'</div>'}
}

function selectSlot(el,id,start,end){
  document.querySelectorAll('.time-slot').forEach(s=>s.classList.remove('selected'));
  el.classList.add('selected');
  selectedSlot={id,start,end};
  // Show continue button
  const parts=selectedDate.split('-');
  const dayNames=T[lang].daysShort;
  const dt=new Date(calYear,parseInt(parts[1])-1,parseInt(parts[2]));
  const dayIdx=(dt.getDay()+6)%7;
  const btn=document.getElementById('continueBtn');
  btn.textContent=`${t('continueWith')} ${dayNames[dayIdx]} ${parts[2]}.${parts[1]}, ${start} ‚Üí`;
  btn.style.display='block';
}

function goToForm(){
  if(!selectedSlot)return;
  const parts=selectedDate.split('-');
  const docIcon=(selectedDoctor.languages||[]).some(l=>['RU','UA'].includes(l.toUpperCase()))?'üë©‚Äç‚öïÔ∏è':'üë®‚Äç‚öïÔ∏è';
  document.getElementById('bookingSummary').innerHTML=`
    <div class="bs-title">${t('yourBooking')}</div>
    <div class="bs-doctor">${docIcon} ${selectedDoctor.name}</div>
    <div class="bs-line">${svcIcons[selectedServiceIdx]} ${selectedService} ¬∑ ${t(selectedServiceKey+'dur')}</div>
    <div class="bs-line">üìÖ ${parts[2]}.${parts[1]}.${parts[0]} ¬∑ ${selectedSlot.start}</div>`;
  goTo(4);
}

async function submitBooking(e){
  e.preventDefault();
  const btn=document.getElementById('submitBtn');
  const errEl=document.getElementById('bookingError');
  errEl.style.display='none';btn.disabled=true;btn.textContent=t('sending');
  const body={
    slotId:selectedSlot.id,
    doctorId:selectedDoctor._id,
    doctorName:selectedDoctor.name,
    patientName:document.getElementById('pName').value,
    phone:document.getElementById('pPhone').value,
    email:document.getElementById('pEmail').value||undefined,
    birthDate:document.getElementById('pBirth').value||undefined,
    insurance:document.getElementById('pInsurance').value||undefined,
    description:document.getElementById('pDesc').value||undefined,
    serviceName:selectedService
  };
  try{
    const res=await fetch(API+'/appointments',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
    const data=await res.json();
    if(!res.ok)throw new Error(data.message||t('errorBooking'));
    if(data.checkoutUrl){window.location.href=data.checkoutUrl;return}
    // Show confirmation
    const parts=selectedDate.split('-');
    document.getElementById('confirmDetails').innerHTML=[
      {l:t('doctor'),v:selectedDoctor.name},
      {l:t('service'),v:selectedService},
      {l:t('date'),v:`${parts[2]}.${parts[1]}.${parts[0]}`},
      {l:t('time'),v:`${selectedSlot.start} (${t(selectedServiceKey+'dur')})`},
      {l:t('patient'),v:document.getElementById('pName').value}
    ].map(r=>`<div class="confirm-row"><span class="cl">${r.l}</span><span class="cv">${r.v}</span></div>`).join('');
    goTo(5);
  }catch(err){
    errEl.textContent=err.message||t('errorGeneric');errEl.style.display='block';
  }finally{btn.disabled=false;btn.textContent=t('confirmBooking')}
}

function resetForm(){
  document.getElementById('patientForm').reset();
  selectedDoctor=null;selectedSlot=null;selectedDate='';calYear=null;calMonth=null;
}

// Init
(function(){
  const saved=localStorage.getItem('rez_lang');
  if(saved&&T[saved])lang=saved;
  setLang(lang);
})();

// Stripe redirect
(function(){
  const params=new URLSearchParams(window.location.search);
  if(params.get('success')==='1'){
    document.getElementById('confirmDetails').innerHTML=
      '<p style="text-align:center;font-size:1.1rem;padding:12px">'+t('bookingConfirmed')+'</p>';
    goTo(5);history.replaceState(null,'','/booking.html');
  }
  if(params.get('cancelled')==='1')history.replaceState(null,'','/booking.html');
})();
</script>
</body>
</html>
